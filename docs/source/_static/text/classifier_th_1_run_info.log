<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
====================================================================================================
● LOAD DATA
====================================================================================================
Data loaded from:
    data/train_transaction.csv
    data/train_identity.csv
====================================================================================================
● PREPROCESS DATA
====================================================================================================
● INITITALIZE WORKFLOW
====================================================================================================
Used params:
    {
    'estimator_type': 'classifier',
    'main_estimator': LGBMClassifier(boosting_type = 'gbdt', class_weight = None, colsample_bytree = 0.9,
        importance_type = 'split', learning_rate = 0.03, max_depth = 13,
        min_child_samples = 1, min_child_weight = 0.001, min_split_gain = 0.0,
        n_estimators = 500, n_jobs = -1, num_leaves = 32, objective = 'binary',
        random_state = None, reg_alpha = 0.3, reg_lambda = 0.3, silent = True,
        subsample = 0.9, subsample_for_bin = 200000, subsample_freq = 3),
    'cv_splitter': TimeSeriesSplit(max_train_size = None, n_splits = 3),
    'metrics': {
        'score': ( < function roc_auc_score at 0x7f1951326c20 > , {
            'greater_is_better': True,
            'needs_proba': True
        }),
        'precision': ( < function precision_score at 0x7f1951335c20 > , {
            'greater_is_better': True,
            'zero_division': 0
        }),
        'custom': ( < function custom_score_metric at 0x7f195f148dd0 > , {
            'greater_is_better': True
        }),
        'confusion matrix': ( < function confusion_matrix at 0x7f19513354d0 > , {
            'labels': [1, 0]
        }, False),
        'classification report': ( < function classification_report at 0x7f1951335dd0 > , {
            'output_dict': True,
            'zero_division': 0
        }, False)
    },
    'split_train_size': 0.7,
    'hp_grid': {
        'estimate__classifier__num_leaves': [2, 4, 8, 16, 32]
    },
    'gs_flag': True,
    'estimator_fit_params': {},
    'del_duplicates': False,
    'pipeline': None,
    'debug_pipeline': False,
    'use_unifier_cache': False,
    'update_unifier_cache': False,
    'use_pipeline_cache': False,
    'update_pipeline_cache': False,
    'gs_verbose': 1000,
    'n_jobs': 1,
    'model_dump': False,
    'runs': None,
    'pos_label': 1,
    'th_strategy': 1,
    'th_points_number': 10,
    'th_plot_flag': False,
    'get_data': {
        'train': {
            'args': ['data/train_transaction.csv', 'data/train_identity.csv'],
            'kw_args': {
                'rows_limit': 10000,
                'random_skip': False,
                'index_col': 'TransactionID'
            }
        },
        'test': {
            'args': ['data/test_transaction.csv', 'data/test_identity.csv'],
            'kw_args': {
                'rows_limit': 10000,
                'random_skip': False,
                'index_col': 'TransactionID'
            }
        }
    },
    'rows_limit': None,
    'random_skip': False
}
====================================================================================================
● UNIFY DATA
====================================================================================================
Warning: gaps found:2232677 0.515629792147806%,
    see debug.log for details.
====================================================================================================
● CREATE PIPELINE
====================================================================================================
Estimator step:
    Pipeline(memory=None,
         steps=[('classifier',
                 PredictionTransformer(clf=LGBMClassifier(boosting_type='gbdt',
                                                          class_weight=None,
                                                          colsample_bytree=0.9,
                                                          importance_type='split',
                                                          learning_rate=0.03,
                                                          max_depth=13,
                                                          min_child_samples=1,
                                                          min_child_weight=0.001,
                                                          min_split_gain=0.0,
                                                          n_estimators=500,
                                                          n_jobs=-1,
                                                          num_leaves=32,
                                                          objective='binary',
                                                          random_state=None,
                                                          reg_alpha=0.3,
                                                          reg_lambda=0.3,
                                                          silent=True,
                                                          subsample=0.9,
                                                          subsample_for_bin=200000,
                                                          subsample_freq=3))),
                ('apply_threshold',
                 ThresholdClassifier(classes_=array([0, 1]), neg_label=0,
                                     pos_label=1, pos_label_ind=1,
                                     threshold=0.5))],
         verbose=False)
====================================================================================================
● SPLIT DATA
====================================================================================================
● OPTIMIZE PIPELINE
====================================================================================================
● ● GRID SEARCH HYPERPARAMETERS
====================================================================================================
hp grid:
    {
    'estimate__classifier__clf__num_leaves': [2, 4, 8, 16, 32]
}
====================================================================================================
+----+-----------------------------------------------+-------------------+--------------------+-----------------------+------------------------+--------------------+---------------------+
|    |   param_estimate__classifier__clf__num_leaves |   mean_test_score |   mean_train_score |   mean_test_precision |   mean_train_precision |   mean_test_custom |   mean_train_custom |
|----+-----------------------------------------------+-------------------+--------------------+-----------------------+------------------------+--------------------+---------------------|
|  0 |                                             2 |          0.802451 |           0.95316  |              1        |                      1 |           1        |                   1 |
|  1 |                                             4 |          0.828922 |           0.994346 |              0.794643 |                      1 |           0.794643 |                   1 |
|  2 |                                             8 |          0.823652 |           0.999999 |              0.809524 |                      1 |           0.809524 |                   1 |
|  3 |                                            16 |          0.828734 |           1        |              0.619048 |                      1 |           0.619048 |                   1 |
|  4 |                                            32 |          0.812705 |           1        |              0.611111 |                      1 |           0.611111 |                   1 |
+----+-----------------------------------------------+-------------------+--------------------+-----------------------+------------------------+--------------------+---------------------+
====================================================================================================
GridSearch best index:
    1
====================================================================================================
GridSearch time:
    {'mean_fit_time': 2.347868633270264, 'mean_score_time': 0.22319310506184892}
====================================================================================================
CV best modifiers:
    {'estimate__classifier__clf__num_leaves': 4}
====================================================================================================
CV best configuration:
    {'estimate__classifier__clf__num_leaves': 4}
====================================================================================================
CV best mean test score:
    0.8289224132440524
====================================================================================================
Errors:
    {}
====================================================================================================
● ● GRID SEARCH CLASSIFIER THRESHOLD
====================================================================================================
+----+-------------------+-------------------+--------------------+-----------------------+------------------------+--------------------+---------------------+
|    |   param_threshold |   mean_test_score |   mean_train_score |   mean_test_precision |   mean_train_precision |   mean_test_custom |   mean_train_custom |
|----+-------------------+-------------------+--------------------+-----------------------+------------------------+--------------------+---------------------|
|  0 |        0.00988295 |          0.863961 |           0.794524 |             0.0882834 |              0.0568392 |          0.0882834 |           0.0568392 |
|  1 |        0.129058   |          0.863961 |           0.794524 |             0.540476  |              0.249084  |          0.540476  |           0.249084  |
|  2 |        0.343087   |          0.863961 |           0.794524 |             0.855769  |              0.473271  |          0.855769  |           0.473271  |
|  3 |        0.343087   |          0.863961 |           0.794524 |             0.855769  |              0.473271  |          0.855769  |           0.473271  |
|  4 |        0.528689   |          0.863961 |           0.794524 |             0.919048  |              0.596491  |          0.919048  |           0.596491  |
|  5 |        0.568647   |          0.863961 |           0.794524 |             0.952381  |              0.596491  |          0.952381  |           0.596491  |
|  6 |        0.678929   |          0.863961 |           0.794524 |             1         |              0.768519  |          1         |           0.768519  |
|  7 |        0.979119   |          0.863961 |           0.794524 |             0         |              0         |          0         |           0         |
|  8 |        0.979119   |          0.863961 |           0.794524 |             0         |              0         |          0         |           0         |
|  9 |        1          |          0.863961 |           0.794524 |             0         |              0         |          0         |           0         |
+----+-------------------+-------------------+--------------------+-----------------------+------------------------+--------------------+---------------------+
====================================================================================================
GridSearch best index:
    0
====================================================================================================
GridSearch time:
    {'mean_fit_time': 9.864171346028645e-05, 'mean_score_time': 0.002269887924194336}
====================================================================================================
CV best modifiers:
    {'threshold': 0.009882946460600903}
====================================================================================================
CV best configuration:
    {'threshold': 0.009882946460600903}
====================================================================================================
CV best mean test score:
    0.8639610607623691
====================================================================================================
Errors:
    {}
====================================================================================================
● ● DUMP RUNS
====================================================================================================
Save run(s) results to file:
    /mlshell/Projects/Project_ieee_fraud_detection//results/runs/1585580103_runs.csv
====================================================================================================
Best run id:
    76b1122f-d4ab-4178-844f-ad3116a69e6a
====================================================================================================
● VALIDATE ON HOLDOUT
====================================================================================================
score:
====================================================================================================
Train:
    0.9730265936431384
Test:
    0.8739490514183413
====================================================================================================
precision:
====================================================================================================
Train:
    0.0649500384319754
Test:
    0.06324404761904762
====================================================================================================
custom:
====================================================================================================
Train:
    0.0649500384319754
Test:
    0.06324404761904762
====================================================================================================
confusion matrix:
====================================================================================================
Train:
    +----+------+------+
    |    |    1 |    0 |
    |----+------+------|
    |  1 |  169 |    3 |
    |  0 | 2433 | 4395 |
    +----+------+------+
Test:
    +----+------+------+
    |    |    1 |    0 |
    |----+------+------|
    |  1 |   85 |    8 |
    |  0 | 1259 | 1648 |
    +----+------+------+
====================================================================================================
classification report:
====================================================================================================
Train:
    +-----------+-------------+------------+------------+-------------+----------------+
    |           |         0.0 |        1.0 |   accuracy |   macro avg |   weighted avg |
    |-----------+-------------+------------+------------+-------------+----------------|
    | precision |    0.999318 |   0.06495  |      0.652 |    0.532134 |       0.976359 |
    | recall    |    0.643673 |   0.982558 |      0.652 |    0.813116 |       0.652    |
    | f1-score  |    0.783004 |   0.121846 |      0.652 |    0.452425 |       0.766758 |
    | support   | 6828        | 172        |      0.652 | 7000        |    7000        |
    +-----------+-------------+------------+------------+-------------+----------------+
Test:
    +-----------+-------------+-----------+------------+-------------+----------------+
    |           |         0.0 |       1.0 |   accuracy |   macro avg |   weighted avg |
    |-----------+-------------+-----------+------------+-------------+----------------|
    | precision |    0.995169 |  0.063244 |   0.577667 |    0.529207 |       0.966279 |
    | recall    |    0.566907 |  0.913978 |   0.577667 |    0.740443 |       0.577667 |
    | f1-score  |    0.722332 |  0.118302 |   0.577667 |    0.420317 |       0.703607 |
    | support   | 2907        | 93        |   0.577667 | 3000        |    3000        |
    +-----------+-------------+-----------+------------+-------------+----------------+
====================================================================================================
● DUMP MODEL
====================================================================================================
Save fitted model to file:
    /mlshell/Projects/Project_ieee_fraud_detection//results/models/84b23bb49a7c016a22e95d0708074123_2481023607577188077_dump.model
====================================================================================================
● LOAD MODEL
====================================================================================================
Load fitted model from file:
    /mlshell/Projects/Project_ieee_fraud_detection//results/models/84b23bb49a7c016a22e95d0708074123_2481023607577188077_dump.model
====================================================================================================
● LOAD DATA
====================================================================================================
Data loaded from:
    data/test_transaction.csv
    data/test_identity.csv
====================================================================================================
● PREPROCESS DATA
====================================================================================================
Warning: no target column 'isFraud' in df, use 0 values
'isFraud'
====================================================================================================
● PREDICT ON TEST
====================================================================================================
Warning: gaps found:2033556 0.46964341801385684%,
    see debug.log for details.
====================================================================================================
Save predictions for new data to file:    
    /mlshell/Projects/Project_ieee_fraud_detection//results/models/84b23bb49a7c016a22e95d0708074123_3392053487631965617_predictions.csv
====================================================================================================
● PREPARE GUI PARAMS
====================================================================================================
Gui dynamic visualisation implements:
    precision plot, TP/FP/FN scatters on base_plot
====================================================================================================
param_estimate__classifier__clf__num_leaves values number=5
====================================================================================================
param_estimate__apply_threshold__threshold values number=10
====================================================================================================
